<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Hostel Complaint System - Login</title>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        "primary": "#00bdd6"
      },
      fontFamily: {
        "display": ["Inter", "sans-serif"]
      }
    }
  }
}
</script>
</head>

<body class="font-display">

<div class="relative flex min-h-screen w-full flex-col bg-background-light dark:bg-background-dark"
style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuDsWJQlTs7PFkN4T0DxAFavQU-342158e9J4RXu5MHdftts8gOzbpQaSbN4JoQVBTT2YZoLxLLm4Uq0_I9gVdkEUOSxjzUDGCnu-2fsMVIMhQq_1BBumyGv-BzO4tL_Iu3_56JiC5Cp2_K5Nit6sNkTUBFWiPCCda08356KN89TPD3ioEskXt2qZit6oWjQyW_2I3oT8mCl74DKsEQKTEcybEC3PbBQO-kh3xZ0Qf8Dq1zTxczK60W84RrzlTsef4c--VobyJt2yIE');
background-size: cover; background-position: center;">

<div class="absolute inset-0 bg-gray-900/40 backdrop-blur-sm"></div>

<div class="layout-container relative flex h-full grow flex-col">
<div class="flex flex-1 items-center justify-center p-6">

<div class="flex w-full max-w-md flex-col items-center gap-6">

<div class="flex w-full flex-col items-center gap-2">
  <div class="flex h-16 w-16 items-center justify-center rounded-full bg-[#FAF9F6] text-[#00BCD4] shadow-md">
    <span class="material-symbols-outlined !text-4xl">school</span>
  </div>
  <h1 class="text-3xl font-bold text-white text-center">University Portal</h1>
</div>

<div class="w-full rounded-xl border border-[#00BCD4]/50 bg-[#FAF9F6] p-6 shadow-2xl">

<div class="flex flex-col items-center">
  <h2 class="text-2xl font-bold text-[#333333]">Hostel Complaint System</h2>
  <p class="pt-1 pb-6 text-center text-base text-gray-500">Sign in to your account</p>
</div>

<form id="loginForm" class="flex flex-col gap-4">

<label class="flex flex-col">
<p>Email Address</p>
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-3 text-gray-400">mail</span>
<input id="email" type="email"
class="h-12 w-full rounded-lg border border-gray-300 p-3 pl-10"
placeholder="Enter your email" required/>
</div>
</label>

<label class="flex flex-col">
<p>Password</p>
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-3 text-gray-400">lock</span>
<input id="passwordField" type="password"
class="h-12 w-full rounded-lg border border-gray-300 p-3 pl-10 pr-10"
placeholder="Enter your password" required/>
</div>
</label>

<label>
<p>Select Your Role</p>
<select id="role" class="h-12 w-full rounded-lg border border-gray-300 p-3">
  <option value="Student">Student</option>
  <option value="Warden">Warden</option>
</select>
</label>

<button type="submit"
class="h-12 w-full rounded-lg bg-gradient-to-r from-[#008080] to-[#000080] text-white font-semibold">
Login
</button>

<a href="homePage.html"
class="h-12 w-full rounded-lg bg-gray-500 text-white font-semibold flex items-center justify-center mt-2">
Back to Home
</a>

</form>
</div>
</div>
</div>
</div>
</div>

<!-- âœ… FIXED LOGIN SCRIPT -->
<script>
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  // ðŸ”¥ CRITICAL FIX â€“ CLEAR OLD USER SESSION
  localStorage.clear();

  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("passwordField").value.trim();
  const role = document.getElementById("role").value;

  try {
    const res = await fetch("http://localhost:5000/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password, role })
    });

    const data = await res.json();

    if (!res.ok) {
      alert(data.message || "Login failed");
      return;
    }

    localStorage.setItem("token", data.token);
    localStorage.setItem("role", data.user.role);
    localStorage.setItem("userName", data.user.name);
    localStorage.setItem("userEmail", data.user.email);

    if (data.user.role === "Student") {
      window.location.href = "student_dashboard.html";
    } else if (data.user.role === "Warden") {
      window.location.href = "warden_dashboard.html";
    }

  } catch (err) {
    alert("Server not responding");
    console.error(err);
  }
});
</script>

</body>
</html>
